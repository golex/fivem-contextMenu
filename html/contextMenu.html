<html>
    <head>
    <script src="nui://game/ui/jquery.js" type="text/javascript"></script>
    <link href="contextMenu.css" rel="stylesheet" type="text/css" />
    </head>
    <body>
        <img id="cursor" src="cursor.png">

        <div id="contextMenu">
            <div id="contextMenuHeader">
                Banshee
            </div>
            <div id="contextSection">
                <div id="contextMenuSectionHeader">
                    Job
                </div>
                <ul>
                    <button class="contextMenuButton">
                        <div class="contextMenuButtonContent">
                            <img class="contextMenuButtonIcon" src="btn_icon_tech.png"/>Cuff</div>
                        <div class="contextMenuButtonProgressBar"></div>
                    </button>
                </ul>
            </div>
        </div>

        <script>
        var documentWidth = document.documentElement.clientWidth;
        var documentHeight = document.documentElement.clientHeight;

        var contextMenu = document.getElementById("contextMenu");
        var cursor = document.getElementById("cursor");
        var cursorX = documentWidth / 2;
        var cursorY = documentHeight / 2;

        function updateCursorPos() {
            cursor.style.left = cursorX;
            cursor.style.top = cursorY;
        }

        function click(x, y) {
            var element = $(document.elementFromPoint(x, y));
            element.focus().click();
        }

        function openContextMenu()
        {
            contextMenu.style.display = "block";
            cursor.style.display = "block";
        }
        function closeContextMenu()
        {
            contextMenu.style.display = "none";
            cursor.style.display = "none";
        }

        function move() {
            var elem = document.getElementById("myBar"); 
            var width = 1;
            var id = setInterval(frame, 10);
            function frame() {
                if (width >= 100) {
                    clearInterval(id);
                } else {
                    width++; 
                    elem.style.width = width + '%'; 
                }
            }
        }

        $(function()
        {
            $(document).mousemove(function(event) {
                cursorX = event.pageX;
                cursorY = event.pageY;
                updateCursorPos();
            });

            document.onkeyup = function (data) {
                if (data.which == 20 || data.which == 27) { // Caps or Escape key
                    $.post('http://golextest/closeContextMenu', JSON.stringify({}));
                }
            };

            window.addEventListener('message', function(event)
            {
                var item = event.data;
                /*
                if (item.type != 'contextMenu')
                {
                    return;
                }*/
                var command = item.command;
                console.log('message recv ' + command);
                switch(command)
                {
                    case 'open':
                        openContextMenu();
                        break;
                    case 'close':
                        closeContextMenu();
                        break;
                    case 'click':
                        click(cursorX - 1, cursorY - 1);
                        break;
                }
            }, false);
        });
        </script>
    </body>
</html>
